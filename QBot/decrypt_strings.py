import idc
import idautils

dec_routine = 0x4065B7
enc_strings = 0x40B930
bytes_arr = 0x410120

def decrypt_string(idx):
	if idx >= 0x36F4:
		return    # out of bounds
	res = ""
	while True:
		c = idc.get_wide_byte(enc_strings + idx) ^ idc.get_wide_byte(bytes_arr + (idx & 0x3F))
		if c == 0: break
		res += chr(c)
		idx += 1
	return res

xrefs = idautils.CodeRefsTo(dec_routine, 0)
for x in xrefs:
	ea = idc.prev_head(x)
	t = idc.get_operand_type(ea, 1)
	if t == idc.o_imm:
		idx = idc.get_operand_value(ea, 1)
		dec = decrypt_string(idx)
		idc.set_cmt(ea, dec, 1)